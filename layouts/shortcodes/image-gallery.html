{{- $images := .Page.Resources.Match ("*.{jpg,jpeg,webp,png}") -}}

<div class="gallery mt-10">
  {{- range $images }}
    <a
      href="{{ .RelPermalink }}"
      class="gallery-item glightbox"
      data-gallery="my-gallery"
    >
      <img
        src="{{ .RelPermalink }}"
        alt="{{ .Name | plainify }}"
        class="img-fluid mb-2 rounded"
      />
    </a>
  {{- end }}
</div>

{{ with (templates.Defer (dict "key" "global")) }}
  {{ with resources.Get "css/gallery.css" }}
    {{ $opts := dict
      "enableSourceMap" hugo.IsDevelopment
      "outputStyle" (cond hugo.IsDevelopment "expanded" "compressed")
      "includePaths" (slice "node_modules/glightbox/dist/css")
    }}
    {{ with . | css.Sass $opts }}
      {{ if hugo.IsProduction }}
        {{ with . | fingerprint }}
          <link
            rel="stylesheet"
            href="{{ .RelPermalink }}"
            integrity="{{ .Data.Integrity }}"
            crossorigin="anonymous"
          />
        {{ end }}
      {{ else }}
        <link rel="stylesheet" href="{{ .RelPermalink }}" />
      {{ end }}
    {{ end }}
  {{ end }}
{{ end }}

{{ with resources.Get "js/gallery.js" }}
  {{$opts := dict
    "minify" (not hugo.IsDevelopment)
    "sourceMap" (cond hugo.IsDevelopment "external" "")
    "targetPath" "js/gallery.js"
  }}
  {{ with . | js.Build $opts }}
    {{ if hugo.IsDevelopment }}
      <script src="{{ .RelPermalink }}"></script>
    {{ else }}
      {{ with . | fingerprint }}
        <script
          src="{{ .RelPermalink }}"
          integrity="{{ .Data.Integrity }}"
          crossorigin="anonymous"
        ></script>
      {{ end }}
    {{ end }}
  {{ end }}
{{ end }}
